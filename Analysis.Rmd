---
title: "Titanic"
author: "John Russell"
date: "1/7/2020"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

When examining the improbable tragedy of the sinking of the Titanic in 1912, it is a reasonable assumption to believe that there was a predictable pattern to who on board survived and who died. It is my belief that women and younger passengers had a greater chance of surviving due to those groups likely taking priority when filling the lifeboats. A thorough analysis will be conducted to test this hypothesis.

```{r, include = F}
library(tidyverse)
train_data <- read_csv('train.csv')
```

## Data and Feature Engineering
```{r}
glimpse(train_data)
```

A quick look at the data shows that there are 891 passengers as well as 12 different variables, including whether or not the passenger survived.


```{r}
train_data <- train_data %>%
  select(-c(Cabin, Ticket))
```
 We quickly notice that the Cabin number of passengers in rarely present, so we will omit this variable from the analysis as it does not provide any useful information for the prediction.
 
```{r}
ggplot(train_data) +
  geom_bar(aes(Survived, fill = Sex), position = "fill")
```
 
A quick visualization of the data shows that the majority of the passengers that survived are, in fact, female. 

To properly examine age, it will be grouped as infant (0-5), child (6-12), teenager (13-19),  young adult (20-29), adult (30-49), and elderly (50+). Before we can group the passengers, we need to deal with the patients with no age recorded. 
```{r}
train_data %>%
  mutate(Ageless = is.na(Age)) %>%
  count(Ageless)
```
We see that there are 177 passengers that do not have a recorded age in the data set. In order to deal with this, we will use the other variables to find the most liekly age group for the passengers with no age and use the average value of that group to estimate the age. Because we are using age groups, the actual value is less important. 

```{r}
train_data <- train_data %>%
  mutate(Age_Group = cut(Age, breaks = c(0, 5, 12, 19, 29, 49, 80), labels = c("Infant", "Child", "Teen", "Young Adult", "Adult", "Elderly")))
```

```{r}
train_data <- train_data %>%
  mutate(Famsize = SibSp + Parch)

find_age <- group_by(train_data, Pclass, Sex, Fare, Famsize) %>%
  summarise(avg_age = mean(Age, na.rm = T))
```
 Now that we have an average age for passengers based on ticket class, gender, and the size of the family, we can assign this average age to the passengers with no recorded age. 

```{r}
train_data <- train_data %>%
  inner_join(find_age)

train_data %>%
  count(is.na(avg_age))

train_data <- train_data %>%
  
```

Now we see that there are only 7 passengers that 

```{r}
ggplot(train_data) +
  geom_bar(aes(Age_Group, fill = Age_Group))
```

A percentage of survival based on age group will be more informative. 
```{r}
 by_age <- train_data %>%
  group_by(Age_Group) %>%
  summarise(prop_lived = sum(Survived == 1) / n()) 

ggplot(by_age) +
  geom_col(aes(Age_Group, prop_lived, fill = Age_Group))
```

Now that we have a proportion of who lived by age group, we can see that it is true that young passengers did indeed have a greater chance of surviving, likely due to priority on the life boats. 

With a basic idea of what to expect from the graphs, it is time to start building a model to predict survival.

## Model Selection

Since we are dealing with a classification problem, we will consider a few different modeling methods: K nearest neighbors, logistic regression, linear discriminant analysis, and quadratic discriminant analysis. 